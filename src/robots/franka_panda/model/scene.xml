<mujoco model="panda scene">
  <include file="panda.xml"/>

  <statistic center="0.3 0 0.4" extent="1"/>

  <!-- ================= PHYSICS STABILIZATION (CRITICAL) ================= -->
  <!-- Higher iterations + Newton solver = much stronger contact handling -->
  <option timestep="0.002"
          iterations="100"
          solver="Newton"
          gravity="0 0 -9.81"/>

  <visual>
    <headlight diffuse="0.6 0.6 0.6" ambient="0.3 0.3 0.3" specular="0 0 0"/>
    <rgba haze="0.15 0.25 0.35 1"/>
    <global azimuth="120" elevation="-20"/>
  </visual>

  <asset>
    <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512" height="3072"/>
    <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4" rgb2="0.1 0.2 0.3"
      markrgb="0.8 0.8 0.8" width="300" height="300"/>
    <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5" reflectance="0.2"/>
  </asset>

  <worldbody>
    <light pos="0 0 1.5" dir="0 0 -1" directional="true"/>

    <!-- ================= WORKSPACE CAMERA ================= -->
    <!-- Positioned 1 meter high, looking directly down at the table -->
    <camera name="workspace_cam" pos="0.45 0 0.8" quat="1 0 0 0" />

    <!-- ================= FLOOR (HARDENED CONTACT) ================= -->
    <!-- Added friction + solref/solimp to prevent penetration -->
    <geom name="floor"
          size="0 0 0.05"
          type="plane"
          material="groundplane"
          friction="1.0 0.005 0.0001"
          solref="0.002 1"
          solimp="0.9 0.95 0.001"/>

    <!-- ================= OBSTACLE WALL ================= -->
    <!-- Placed directly between the pick zone and the drop zone. 
         Forces the RRT to plan an arcing motion over the top! -->
    <!-- <body name="obstacle_wall" pos="0.2 0.25 0.15"> -->
      <!-- WIDENED TO 100cm (half-width 0.5) -->
      <!-- CRITICAL FIX: Added margin="0.05" and gap="0.05" to force the collision 
           engine to track distance up to 5cm away without applying physical forces! -->
      <!-- <geom type="box" size="0.5 0.02 0.15" rgba="0.2 0.5 0.8 0.6" mass="100" margin="0.02" gap="0.02" /> -->
    <!-- </body> -->

    <!-- ================= TARGET CUBES ================= -->
    
    <!-- RED CUBE -->
    <body name="target_cube_red" pos="0.45 0.0 0.02">
      <freejoint/>
      <geom name="cube_geom_red" type="box" size="0.02 0.02 0.02" rgba="0.8 0.2 0.2 1" mass="0.05"
            friction="1.2 0.005 0.0001" solref="0.002 1" solimp="0.9 0.95 0.001" margin="0.001"/>
    </body>

    <!-- GREEN CUBE -->
    <body name="target_cube_green" pos="0.35 0.2 0.02">
      <freejoint/>
      <geom name="cube_geom_green" type="box" size="0.02 0.02 0.02" rgba="0.2 0.8 0.2 1" mass="0.05"
            friction="1.2 0.005 0.0001" solref="0.002 1" solimp="0.9 0.95 0.001" margin="0.001"/>
    </body>

    <!-- BLUE CUBE -->
    <body name="target_cube_blue" pos="0.35 -0.2 0.02">
      <freejoint/>
      <geom name="cube_geom_blue" type="box" size="0.02 0.02 0.02" rgba="0.2 0.2 0.8 1" mass="0.05"
            friction="1.2 0.005 0.0001" solref="0.002 1" solimp="0.9 0.95 0.001" margin="0.001"/>
    </body>

    <!-- YELLOW CUBE -->
    <body name="target_cube_yellow" pos="0.45 0.2 0.02">
      <freejoint/>
      <geom name="cube_geom_yellow" type="box" size="0.02 0.02 0.02" rgba="0.8 0.8 0.2 1" mass="0.05"
            friction="1.2 0.005 0.0001" solref="0.002 1" solimp="0.9 0.95 0.001" margin="0.001"/>
    </body>
  </worldbody>
</mujoco>